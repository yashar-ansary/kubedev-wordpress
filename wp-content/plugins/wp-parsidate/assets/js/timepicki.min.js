(function(f){f.fn.timepicki=function(y){var e=f.extend({},{format_output:function(k,l,r){if(e.show_meridian)return k=Math.min(Math.max(parseInt(k),1),12),10>k&&(k="0"+k),l=Math.min(Math.max(parseInt(l),0),59),10>l&&(l="0"+l),k+":"+l+" "+r;k=Math.min(Math.max(parseInt(k),0),23);10>k&&(k="0"+k);l=Math.min(Math.max(parseInt(l),0),59);10>l&&(l="0"+l);return k+":"+l},increase_direction:"up",custom_classes:"",min_hour_value:1,max_hour_value:12,show_meridian:!0,step_size_hours:"1",step_size_minutes:"1",
overflow_minutes:!1,disable_keyboard_mobile:!1,reset:!1,on_change:null,input_writable:!1},y);return this.each(function(){function k(b){return f.contains(t[0],b[0])||t.is(b)}function l(b,d){var a=c.find(".ti_tx input").val(),g=c.find(".mi_tx input").val(),m="";e.show_meridian&&(m=c.find(".mer_tx input").val());0===a.length||0===g.length||e.show_meridian&&0===m.length||(h.attr("data-timepicki-tim",a),h.attr("data-timepicki-mini",g),e.show_meridian?(h.attr("data-timepicki-meri",m),h.val(e.format_output(a,
g,m))):h.val(e.format_output(a,g)));if(null!==e.on_change)e.on_change(h[0]);d&&q()}function r(){z(e.start_time);c.fadeIn();if(!e.input_writable){var b=c.find("input:visible").first();b.focus()}var d=function(a){if(9===a.which&&a.shiftKey){b.off("keydown",d);a=f(":input:visible:not(.timepicki-input)");var g=a.index(h);a.get(g-1).focus()}};b.on("keydown",d)}function q(){c.fadeOut("fast")}function z(b){var d;if(h.is("[data-timepicki-tim]")){var a=Number(h.attr("data-timepicki-tim"));var g=Number(h.attr("data-timepicki-mini"));
e.show_meridian&&(d=h.attr("data-timepicki-meri"))}else"object"===typeof b?(a=Number(b[0]),g=Number(b[1]),e.show_meridian&&(d=b[2])):(b=new Date,a=b.getHours(),g=b.getMinutes(),d="\u0642.\u0638",e.show_meridian&&(0==a?a=12:12==a?d="\u0628.\u0638":12<a&&(a-=12,d="\u0628.\u0638")));10>a?c.find(".ti_tx input").val("0"+a):c.find(".ti_tx input").val(a);10>g?c.find(".mi_tx input").val("0"+g):c.find(".mi_tx input").val(g);e.show_meridian&&(10>d?c.find(".mer_tx input").val("0"+d):c.find(".mer_tx input").val(d))}
function u(b,d){var a=Number(c.find(".time .ti_tx input").val()),g=Number(e.min_hour_value),m=Number(e.max_hour_value),p=Number(e.step_size_hours);if(b&&b.hasClass("action-next")||"next"===d)a+p>m?(a=g,a=10>a?"0"+a:String(a),c.find(".time .ti_tx input").val(a)):(a+=p,10>a&&(a="0"+a),c.find(".time .ti_tx input").val(a));else if(b&&b.hasClass("action-prev")||"prev"===d)a-p<Number(e.min_hour_value)?(a=m,a=10>a?"0"+a:String(a),c.find(".time .ti_tx input").val(a)):(a-=p,10>a&&(a="0"+a),c.find(".time .ti_tx input").val(a))}
function v(b,d){var a=Number(c.find(".mins .mi_tx input").val()),g=Number(e.step_size_minutes);if(b&&b.hasClass("action-next")||"next"===d)59<a+g?(c.find(".mins .mi_tx input").val("00"),e.overflow_minutes&&u(null,"next")):(a+=g,10>a?c.find(".mins .mi_tx input").val("0"+a):c.find(".mins .mi_tx input").val(a));else if(b&&b.hasClass("action-prev")||"prev"===d)-1>=a-g?(c.find(".mins .mi_tx input").val(60-g),e.overflow_minutes&&u(null,"prev")):(a-=g,10>a?c.find(".mins .mi_tx input").val("0"+a):c.find(".mins .mi_tx input").val(a))}
function w(b,d){var a=c.find(".meridian .mer_tx input").val();if(b&&b.hasClass("action-next")||"next"===d)"\u0642.\u0638"==a?c.find(".meridian .mer_tx input").val("\u0628.\u0638"):c.find(".meridian .mer_tx input").val("\u0642.\u0638");else if(b&&b.hasClass("action-prev")||"prev"===d)"\u0642.\u0638"==a?c.find(".meridian .mer_tx input").val("\u0628.\u0638"):c.find(".meridian .mer_tx input").val("\u0642.\u0638")}var h=f(this),x=h.outerHeight();x+=10;f(h).wrap("<div class='time_pick'>");var t=f(this).parents(".time_pick"),
n=f("<div class='timepicker_wrap "+e.custom_classes+"'><div class='arrow_top'></div><div class='time'><div class='prev action-next'></div><div class='ti_tx'><input type='text' class='timepicki-input'"+(e.disable_keyboard_mobile?"readonly":"")+"></div><div class='next action-prev'></div></div><div class='mins'><div class='prev action-next'></div><div class='mi_tx'><input type='text' class='timepicki-input'"+(e.disable_keyboard_mobile?"readonly":"")+"></div><div class='next action-prev'></div></div>");
e.show_meridian&&n.append("<div class='meridian'><div class='prev action-next'></div><div class='mer_tx'><input type='text' class='timepicki-input' readonly></div><div class='next action-prev'></div></div>");t.append(n);var c=f(this).next(".timepicker_wrap");c.find("div");n=t.find("input");f(".reset_time").on("click",function(b){h.val("");q()});f(".timepicki-input").keydown(function(b){if(13==b.keyCode)b.preventDefault(),l(),q();else{var d=f(this).parent().parent(),a=f(this),g=a.val();done=!1;setTimeout(function(){if(!done){var m=
/^\d+$/.test(a.val()),p=""===a.val();d.hasClass("time")?m?(m=e.show_meridian?Math.min(Math.max(parseInt(a.val()),1),12):Math.min(Math.max(parseInt(a.val()),0),23),a.val(m)):p||a.val(g):d.hasClass("mins")?m?(m=Math.min(Math.max(parseInt(a.val()),0),59),a.val(m)):p||a.val(g):d.hasClass("meridian")&&b.preventDefault();done=!0}},0)}});f(document).on("touchstart",function(b){k(f(b.target))||q()});f(document).on("click",function(b){f(b.target).is(c)||"block"!=c.css("display")||f(b.target).is(f(".reset_time"))||
(f(b.target).is(h)?(c.css({top:x+"px",left:"0px"}),r()):l(b,!k(f(b.target))))});h.on("focus",r);n.on("focus",function(){var b=f(this);b.is(h)||b.select()});n.on("keydown",function(b){var d,a=f(this);38===b.which?d="next":40===b.which&&(d="prev");a.closest(".timepicker_wrap .time").length?u(null,d):a.closest(".timepicker_wrap .mins").length?v(null,d):a.closest(".timepicker_wrap .meridian").length&&e.show_meridian&&w(null,d)});n.on("blur",function(){setTimeout(function(){var b=f(document.activeElement);
b.is(":input")&&!k(b)&&(l(),q())},0)});n=c.find(".action-next");var A=c.find(".action-prev");f(A).add(n).on("click",function(){var b=f(this);"time"==b.parent().attr("class")?u(b):"mins"==b.parent().attr("class")?v(b):e.show_meridian&&w(b)})})}})(jQuery);